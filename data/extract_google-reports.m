clc
close all
clear all

% Read from file
t1 = readtable('2020_IT_Region_Mobility_Report.csv');
t2 = readtable("2021_IT_Region_Mobility_Report.csv");
t3 = readtable("2022_IT_Region_Mobility_Report.csv");

regions = ["Piemonte",...
    "Valle d'Aosta",...
    "Lombardia",...
    "Trentino Alto Adige",...
    "Veneto",...
    "Friuli-Venezia Giulia",...
    "Liguria",...
    "Emilia Romagna",...
    "Toscana",...
    "Umbria",...
    "Marche",...
    "Lazio",...
    "Abruzzo",...
    "Molise",...
    "Campania",...
    "Puglia",...
    "Basilicata",...
    "Calabria",...
    "Sicilia",...
    "Sardegna"];

ISO = ["IT-21";...
    "IT-23";...
    "IT-25";...
    "IT-32";...
    "IT-34";...
    "IT-36";...
    "IT-42";...
    "IT-45";...
    "IT-52";...
    "IT-55";...
    "IT-57";...
    "IT-62";...
    "IT-65";...
    "IT-67";...
    "IT-72";...
    "IT-75";...
    "IT-77";...
    "IT-78";...
    "IT-82";...
    "IT-88"];

% We only consider Workplace Mobility (6th column of remaining tables)
Time_GMD = datetime(2020,02,15):datetime(2022,10,15);
GMD = zeros(20,length(Time_GMD));

for i = 1:20
    t1_temp = t1(ismember(t1.iso_3166_2_code, ISO(i)),:);
    t2_temp = t2(ismember(t2.iso_3166_2_code, ISO(i)),:);
    t3_temp = t3(ismember(t3.iso_3166_2_code, ISO(i)),:);
    t1_temp = t1_temp(:,[6 9 10:15]); 
    t2_temp = t2_temp(:,[6 9 10:15]); 
    t3_temp = t3_temp(:,[6 9 10:15]);
    t_temp = [t1_temp;t2_temp;t3_temp]; 
    clear t1_temp t2_temp t3_temp; t_temp(:,1)=[];
    GMD(i,:) = table2array(t_temp(:,6))';
end


GMD = 1+GMD/100; 

save('google-data.mat','Time_GMD','GMD')